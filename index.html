<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR Code Generator</title>

  <!-- Local library (must exist in same folder) -->
  <script src="qrcode.min.js"></script>

  <style>
    :root{
      --bg:#070b18;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.12);
      --ink:#eaf1ff;
      --muted:#a8b4d8;
      --good:#22c55e;
      --bad:#ef4444;
      --shadow: 0 30px 80px rgba(0,0,0,.55);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--ink);
      background:
        radial-gradient(1100px 700px at 15% -10%, rgba(139,92,246,.35), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(14,165,233,.25), transparent 55%),
        radial-gradient(900px 650px at 60% 120%, rgba(34,197,94,.18), transparent 55%),
        var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    /* ===== Layout ===== */
    .shell{
      width:min(1050px, 100%);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
    }

    .card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, rgba(139,92,246,.45), rgba(14,165,233,.35), rgba(34,197,94,.25));
      filter: blur(26px);
      opacity:.45;
      pointer-events:none;
    }
    .inner{ position:relative; padding:16px; }

    /* ===== Header ===== */
    .hero{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .title{ margin:0; font-size:22px; letter-spacing:.2px; line-height:1.2; }
    .subtitle{ margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.45; max-width: 52ch; }

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color: var(--muted); font-size:12px; white-space:nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--bad);
      box-shadow: 0 0 0 4px rgba(239,68,68,.18);
    }
    .dot.ok{
      background: var(--good);
      box-shadow: 0 0 0 4px rgba(34,197,94,.16);
    }

    /* ===== Inputs ===== */
    label{ display:block; font-size:12px; color:var(--muted); margin: 8px 0 8px; }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: var(--ink);
      outline:none;
      transition: .15s border-color, .15s box-shadow, .15s transform;
    }
    input:focus, select:focus{
      border-color: rgba(139,92,246,.65);
      box-shadow: 0 0 0 5px rgba(139,92,246,.18);
      transform: translateY(-1px);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }

    /* ===== Buttons ===== */
    .btns{ display:flex; flex-wrap:wrap; gap:10px; margin-top:14px; }
    button{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      padding:12px 14px;              /* larger tap targets for mobile */
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      transition: .15s transform, .15s background, .15s opacity;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); }
    button[disabled]{ opacity:.45; cursor:not-allowed; transform:none; }

    .primary{
      border-color: transparent;
      background: linear-gradient(120deg, rgba(139,92,246,.95), rgba(14,165,233,.85));
      box-shadow: 0 12px 30px rgba(139,92,246,.18);
    }

    .note{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }

    /* ===== QR panel (NO OVERFLOW) ===== */
    .qrWrap{ display:grid; place-items:center; }
    .qrPanel{
      width:100%;
      max-width: 420px;
      border-radius: 22px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      padding:14px;
      position:relative;
      box-shadow: 0 20px 60px rgba(0,0,0,.40);
    }
    .qrPanel::before{
      content:"";
      position:absolute; inset:-2px;
      border-radius: 24px;
      background: linear-gradient(120deg, rgba(139,92,246,.35), rgba(14,165,233,.25), rgba(34,197,94,.20));
      filter: blur(18px);
      opacity:.55;
      pointer-events:none;
    }
    .qrPanelInner{
      position:relative;
      background: #fff;
      border-radius:18px;
      padding:14px;
      display:grid;
      place-items:center;
      overflow:hidden;                 /* KEY: keep QR inside */
    }

    /* The QR container itself */
    #qr{
      width: 100%;
      display:grid;
      place-items:center;
    }

    /* Make sure canvas/img never exceed the white box */
    #qr canvas, #qr img{
      display:block;
      max-width:100%;
      max-height: 100%;
      height:auto;
    }

    /* Toast */
    .toast{
      position:fixed; bottom:18px; left:50%;
      transform:translateX(-50%);
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.65);
      color: var(--ink);
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:.2s opacity, .2s transform;
      backdrop-filter: blur(10px);
      max-width: calc(100vw - 32px);
      text-align:center;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-4px); }

    /* ===== Mobile tweaks ===== */
    @media (max-width: 920px){
      .shell{ grid-template-columns:1fr; }
      .qrPanel{ max-width: 520px; }
    }
    @media (max-width: 600px){
      body{ padding:14px; }
      .inner{ padding:14px; }
      .title{ font-size:20px; }
      .grid{ grid-template-columns:1fr; } /* stack fields */
      .btns button{ flex: 1 1 calc(50% - 10px); } /* 2 per row */
    }
    @media (max-width: 380px){
      .btns button{ flex: 1 1 100%; } /* 1 per row on very small screens */
    }

    /* =========================
   MOBILE RESPONSIVENESS
   ========================= */

/* 1Ô∏è‚É£ Stack layout on tablets & phones */
@media (max-width: 900px) {
  .shell {
    grid-template-columns: 1fr;
  }
}

/* 2Ô∏è‚É£ Improve spacing & readability on phones */
@media (max-width: 600px) {
  body {
    padding: 14px;
  }

  .inner {
    padding: 14px;
  }

  .title {
    font-size: 20px;
  }

  .subtitle {
    font-size: 13px;
  }

  /* Stack form fields */
  .grid {
    grid-template-columns: 1fr;
  }

  /* Bigger tap targets */
  input,
  select,
  button {
    font-size: 16px; /* prevents iOS zoom */
  }

  /* Buttons: 2 per row */
  .btns button {
    flex: 1 1 calc(50% - 10px);
  }
}

/* 3Ô∏è‚É£ Very small phones */
@media (max-width: 380px) {
  .btns button {
    flex: 1 1 100%;
  }
}

/* =========================
   QR CONTAINER SAFETY
   ========================= */

/* Keep QR always inside white card */
.qrPanelInner {
  overflow: hidden;
}

/* QR scales correctly on mobile */
#qr {
  width: 100%;
  display: grid;
  place-items: center;
}

/* Prevent canvas/img overflow */
#qr canvas,
#qr img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Limit QR panel width on large screens */
.qrPanel {
  max-width: 420px;
  margin: 0 auto;
}

  </style>
</head>

<body>
  <div class="shell">
    <div class="card">
      <div class="inner">
        <div class="hero">
          <div>
            <h1 class="title">QR Code Generator</h1>
            <p class="subtitle">Paste any link or text ‚Üí generate a QR instantly. Runs fully on-device.</p>
          </div>
          <div class="badge">
            <span id="libDot" class="dot"></span>
            <span id="libText">Library: Not loaded</span>
          </div>
        </div>

        <label for="url">Link / Text</label>
        <input id="url" type="text" placeholder="https://example.com" autocomplete="off" inputmode="url" />

        <div class="grid">
          <div>
            <label for="size">Size (px)</label>
            <input id="size" type="number" min="160" max="900" value="360" />
          </div>
          <div>
            <label for="ec">Error correction</label>
            <select id="ec">
              <option value="L">L (7%)</option>
              <option value="M" selected>M (15%)</option>
              <option value="Q">Q (25%)</option>
              <option value="H">H (30%)</option>
            </select>
          </div>
          <div>
            <label for="fg">QR color</label>
            <input id="fg" type="text" value="#000000" />
          </div>
          <div>
            <label for="bg">Background</label>
            <input id="bg" type="text" value="#ffffff" />
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="gen">Generate</button>
          <button id="download" disabled>Download PNG</button>
          <button id="copy" disabled>Copy image</button>
          <button id="clear">Clear</button>
        </div>

        <div class="note">
          Tip: If you paste <b>google.com</b> it auto-fixes to <b>https://google.com</b>.
          If you plan to print small or add a logo later, use <b>H</b>.
        </div>
      </div>
    </div>

    <div class="card qrWrap">
      <div class="inner" style="width:100%;">
        <div class="qrPanel">
          <div class="qrPanelInner" id="qrBoxShell">
            <div id="qr"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const elUrl = document.getElementById("url");
    const elSize = document.getElementById("size");
    const elEC = document.getElementById("ec");
    const elFG = document.getElementById("fg");
    const elBG = document.getElementById("bg");

    const qrBox = document.getElementById("qr");
    const qrShell = document.getElementById("qrBoxShell");

    const btnGen = document.getElementById("gen");
    const btnDl = document.getElementById("download");
    const btnCopy = document.getElementById("copy");
    const btnClear = document.getElementById("clear");

    const toast = document.getElementById("toast");
    const libDot = document.getElementById("libDot");
    const libText = document.getElementById("libText");

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1700);
    }

    function normalizeInput(v){ return (v || "").trim(); }

    function normalizeUrlLike(s){
      const t = normalizeInput(s);
      if (!t) return "";
      const hasScheme = /^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(t);
      if (hasScheme) return t;
      const looksLikeDomain = /^[\w.-]+\.[a-zA-Z]{2,}(\/.*)?$/.test(t);
      return looksLikeDomain ? ("https://" + t) : t;
    }

    function ecToLevel(letter){
      const L = window.QRCode && window.QRCode.CorrectLevel;
      if (!L) return null;
      if (letter === "L") return L.L;
      if (letter === "M") return L.M;
      if (letter === "Q") return L.Q;
      if (letter === "H") return L.H;
      return L.M;
    }

    function ensureLib(){
      const ok = (typeof window.QRCode === "function") && !!window.QRCode.CorrectLevel;
      libDot.classList.toggle("ok", ok);
      libText.textContent = ok ? "Library: Loaded" : "Library: Not loaded";
      return ok;
    }

    function clearQR(){
      qrBox.innerHTML = "";
      btnDl.disabled = true;
      btnCopy.disabled = true;
    }

    function getMaxSizeThatFits(){
      // QR should always fit inside the white panel on mobile.
      // Take the white panel inner width and leave some padding.
      const w = Math.floor(qrShell.clientWidth - 16);
      return Math.max(160, Math.min(900, w));
    }

    function renderQR(){
      if(!ensureLib()){
        showToast("QR library not loaded (check qrcode.min.js)");
        return;
      }

      const text = normalizeUrlLike(elUrl.value);
      if(!text){
        showToast("Paste a link first üôÇ");
        clearQR();
        return;
      }

      const requested = parseInt(elSize.value || "360", 10);
      const fit = getMaxSizeThatFits();
      const size = Math.max(160, Math.min(900, Math.min(requested, fit))); // clamp to container
      if (requested !== size) elSize.value = size; // keep UI consistent

      const ec = elEC.value;
      const fg = normalizeInput(elFG.value) || "#000000";
      const bg = normalizeInput(elBG.value) || "#ffffff";

      qrBox.innerHTML = "";
      qrBox.style.width = size + "px";
      qrBox.style.height = size + "px";

      new QRCode(qrBox, {
        text,
        width: size,
        height: size,
        colorDark: fg,
        colorLight: bg,
        correctLevel: ecToLevel(ec)
      });

      btnDl.disabled = false;
      btnCopy.disabled = false;
      showToast("QR generated ‚úÖ");
    }

    function getQrNode(){
      return qrBox.querySelector("canvas") || qrBox.querySelector("img");
    }

    function downloadPNG(){
      const node = getQrNode();
      if(!node){ showToast("Generate a QR first"); return; }
      const dataUrl = (node.tagName === "CANVAS") ? node.toDataURL("image/png") : node.src;
      const a = document.createElement("a");
      a.download = "qr-code.png";
      a.href = dataUrl;
      a.click();
    }

    async function copyImage(){
      const node = getQrNode();
      if(!node){ showToast("Generate a QR first"); return; }
      try{
        let blob;
        if(node.tagName === "CANVAS"){
          blob = await new Promise(res => node.toBlob(res, "image/png"));
        } else {
          const r = await fetch(node.src);
          blob = await r.blob();
        }
        await navigator.clipboard.write([new ClipboardItem({ "image/png": blob })]);
        showToast("Copied ‚úÖ");
      }catch(e){
        console.error(e);
        showToast("Copy blocked by browser");
      }
    }

    function clearAll(){
      elUrl.value = "";
      clearQR();
      showToast("Cleared");
    }

    btnGen.addEventListener("click", renderQR);
    btnDl.addEventListener("click", downloadPNG);
    btnCopy.addEventListener("click", copyImage);
    btnClear.addEventListener("click", clearAll);
    elUrl.addEventListener("keydown", (e)=>{ if(e.key === "Enter") renderQR(); });

    // If user rotates / resizes, regenerate to fit the panel (only if QR exists)
    window.addEventListener("resize", () => {
      const node = getQrNode();
      if (node) renderQR();
    });

    window.addEventListener("load", () => {
      ensureLib();
      if (ensureLib()) showToast("Ready ‚úÖ");
    });
  </script>
</body>
</html>
